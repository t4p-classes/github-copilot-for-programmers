=== Demo: C# ASP.NET MVC Web API with Visual Studio

This demo shows how to use GitHub Copilot to help you write a new C# ASP.NET MVC Web API application with Visual Studio. The prompts below are suggestions to help you explore GitHub Copilot; please feel free to modify them.

. Install the GitHub Copilot extensions for Visual Studio. Visual Studio needs both the GitHub Copilot and GitHub Copilot Chat extensions.
. Open Visual Studio and create a new project with the following options:

- Project type: ASP.NET Core Web API
- Project name: DemoWebAPI
- Framework: .NET 8 (Long-Term Support)
- Authentication type: None
- Configure HTTPS: Checked
- Enable OpenAPI support: Checked
- Do not use top-level statements: Unchecked
- Use controllers: Checked


Click `Create` to have Visual Studio create the project. Once created, please proceed.

[start=3]
. Run the project by clicking the green arrow in the toolbar. The project will start and open a new browser window - this is the Swagger UI for the Web API project. The URL will be localhost. Visual Studio assigns a port number when it creates the project.
. To open Copilot Chat, click on the `View` menu, then click 'GitHub Copilot Chat'.
. Open the `Program.cs` file in the editor. Highlight the following line of code.

.Program.cs
[%linenums,c#]
----
builder.Services.AddControllers();
----

[start=6]
. In the Copilot Chat window, type the following prompt and press `Enter` to see the response from Copilot.

.Copilot Chat Prompt
[source,text]
What are controllers in an ASP.NET Core Web API application?

[start=7]
. Review the response. Notice that is detects the line of code you highlighted, and offers a response to the prompt. It explains that controllers are classes that handle incoming HTTP requests and return responses to the client. It also provides a code example of how to create a new controller. It may even offer to create a new controller for you. If you like the response, you can accept it. Remember, Copilot and generative AI is non-deterministic, so the response will vary.
. If present, click the "Insert in new file" button, save the file in the `Controllers` folder. If the "Insert in new file" button is not present, create a new file in the `Controllers` folder and name it after the class code generated by Copilot. Copy the code from the chat window and paste it into the new file. Save the file.
. If any namespaces are missing, use the usual Visual Studio tooling (the lightbulb) to add the missing namespaces. The final controller code should look similar to this:

.Copilot Proposed Change: Controllers/MyController.cs
[%linenums,c#]
----
using Microsoft.AspNetCore.Mvc;

[ApiController]
[Route("[controller]")]
public class MyController : ControllerBase
{
    [HttpGet]
    public IEnumerable<string> Get()
    {
        return new string[] { "value1", "value2" };
    }

    [HttpPost]
    public void Post([FromBody] string value)
    {
        // Code to handle POST request
    }
}
----

[start=10]
. Highlight the following code.

.Controllers/MyController.cs
[%linenums,c#]
----
[HttpGet]
public IEnumerable<string> Get()
{
    return new string[] { "value1", "value2" };
}
----

*Prompt Copilot with the following question:*

.Copilot Chat Prompt
[source,text]
How do access this endpoint when I run the application?

The probable response will answer the question specifically for the `Get` method, but will take into account the surrounding code such as the controller name to provide the answer.

[start=11]
. With the following code still highlighted, prompt Copilot with the following question, "How do I write a unit test for this code?"

.Controllers/MyController.cs
[%linenums,c#]
----
[HttpGet]
public IEnumerable<string> Get()
{
    return new string[] { "value1", "value2" };
}
----

**The probable response will be something similar to this:**

.Copilot Chat Response
----
To write a unit test for the Get method in your MyController class, you can use a testing framework like xUnit. Here's an example of how you might write such a test:
----

.Controllers/MyControllerTests.cs
[%linenums,c#]
----
using Xunit;
using Microsoft.AspNetCore.Mvc;
using System.Linq;
using DemoWebApi.Controllers;

public class MyControllerTests
{
    [Fact]
    public void Get_ReturnsExpectedValues()
    {
        // Arrange
        var controller = new MyController();

        // Act
        var result = controller.Get();

        // Assert
        var values = result.ToList();
        Assert.Equal(2, values.Count);
        Assert.Equal("value1", values[0]);
        Assert.Equal("value2", values[1]);
    }
}
----

.Copilot Chat Response Continued
----
In this test:

* The Arrange step creates an instance of MyController.
* The Act step calls the Get method.
* The Assert step checks that the returned values are as expected.

This test checks the behavior of the Get method in isolation, which is the essence of unit testing. If the Get method had dependencies, you would typically use mocking to isolate the behavior of the method from its dependencies. However, in this case, the Get method has no dependencies, so no mocking is necessary.
----

[start=12]
. In the previous response, Copilot not only provided the code for the unit test, but also explained the purpose of the test and the steps involved in writing it. To accept the response, you will need to create a new unit test project. As you probably know, in C#, unit tests are not colocated with the application code for the same project, so let's create a new XUnit project to host the unit test code. Right-click on the solution in the Solution Explorer, and select `Add` > `New Project`. In the `Create a new project` dialog, select `xUnit Test Project` and click `Next`. Name the project `DemoWebApi.Tests` and click `Create`. Once the project is created, proceed.
. With the new unit test project created, return to the chat and add the unit test to the project using the techniques described in the previous steps. It is recommended to create a `Controllers` folder in the unit test project and save the unit test code in a file named `MyControllerTests.cs`. Once the file is saved, proceed.
. To run the tests, the main `DemoWebAPI` project will need to be added as a reference to the unit test project. Right-click on the `Dependencies` node in the `DemoWebApi.Tests` project, and select `Add Project Reference`. In the `Add Project Reference` dialog, select the `DemoWebAPI` project and click `OK`. Once the reference is added, proceed.
. Open the Test Explorer window and run the tests. The tests should pass using the code above, if the code generated for you is slightly different they may or may not pass.
. Between the `Get` and `Post` methods in the `MyController` class, add the following code:

.Controllers/MyController.cs
[%linenums,c#]
----
// GET my/1
----

When you press enter after typing the comment, Copilot will suggest code to implement the endpoint described by the comment. It may make suggestions one line at a time, or it may suggest the entire method at once.

Review the suggestions made, accept and modify as needed. The final code should look similar to this:

.Controllers/MyController.cs
[%linenums,c#]
----
// GET my/1
[HttpGet("{id}")]
public string Get(int id)
{
  return "value";
}
----

[start=17]
. In the Copilot chat window, type the following prompt and press `Enter` to see the response from Copilot.

.Copilot Chat Prompt
[source,text]
I need a service to manage a list of colors. Each color will have an id, a name, and a hexcode. Please generate a Color class, a service class to manage a list of colors, including adding, replacing, and deleting a color. In the constructor of the service class, initialize the list of colors with objects for red, green, and blue. Also, how do I register the service with the Demo Web API application and inject it into MyController?

The probable response will include explanations and code examples for the requested classes and configurations. Below are the code snippets generated when creating this tutorial.

.Copilot Proposed Change: Models/Color.cs
[%linenums,c#]
----
public class Color
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string HexCode { get; set; }
}
----

.Copilot Proposed Change: Services/ColorService.cs
[%linenums,c#]
----
public class ColorService
{
    private List<Color> _colors;

    public ColorService()
    {
        _colors = new List<Color>
        {
            new Color { Id = 1, Name = "Red", HexCode = "#FF0000" },
            new Color { Id = 2, Name = "Green", HexCode = "#00FF00" },
            new Color { Id = 3, Name = "Blue", HexCode = "#0000FF" }
        };
    }

    public IEnumerable<Color> GetColors() => _colors;

    public Color GetColor(int id) => _colors.FirstOrDefault(c => c.Id == id);

    public void AddColor(Color color) => _colors.Add(color);

    public void ReplaceColor(int id, Color color)
    {
        var index = _colors.FindIndex(c => c.Id == id);
        if (index != -1)
        {
            _colors[index] = color;
        }
    }

    public void DeleteColor(int id)
    {
        var color = _colors.FirstOrDefault(c => c.Id == id);
        if (color != null)
        {
            _colors.Remove(color);
        }
    }
}
----

.Copilot Proposed Change: Program.cs
[%linenums,c#]
----
builder.Services.AddSingleton<ColorService>();
----

.Copilot Proposed Change: Controllers/MyController.cs
[%linenums,c#]
----
public class MyController : ControllerBase
{
    private readonly ColorService _colorService;

    public MyController(ColorService colorService)
    {
        _colorService = colorService;
    }

    // Existing code...
}
----

If you like, integrate the new code into the existing application. It would be best if you renamed the `MyController` to `ColorsController`. Update the existing methods to use the service, and add two methods for replacing and deleting a color. Also, the unit tests will need to be updated. Experiment with Copilot in-editor suggestions and Copilot chat to complete the changes.
